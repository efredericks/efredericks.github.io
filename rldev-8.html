<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/assets/styles/styles.css">
<link rel="stylesheet" href="https://indestructibletype.com/fonts/Jost.css" type="text/css" charset="utf-8" />
<script src="https://kit.fontawesome.com/79c31398dc.js" crossorigin="anonymous"></script>

<!-- favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
<link rel="manifest" href="/assets/img/site.webmanifest">
<link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- feed -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="erik fredericks" />




<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>fredericks does the roguelikedev tutorial - 7/8 | erik fredericks</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="fredericks does the roguelikedev tutorial - 7/8" />
<meta name="author" content="efredericks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="a*, slimes, more fixes, the end (for now)" />
<meta property="og:description" content="a*, slimes, more fixes, the end (for now)" />
<meta property="twitter:description" content="a*, slimes, more fixes, the end (for now)" />
<link rel="canonical" href="http://localhost:4000/rldev-8.html" />
<meta property="og:url" content="http://localhost:4000/rldev-8.html" />
<meta property="og:site_name" content="erik fredericks" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-20T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="fredericks does the roguelikedev tutorial - 7/8" />
<meta name="twitter:site" content="@efredericks" />
<meta name="twitter:creator" content="@efredericks" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"efredericks"},"dateModified":"2023-08-20T00:00:00-04:00","datePublished":"2023-08-20T00:00:00-04:00","description":"a*, slimes, more fixes, the end (for now)","headline":"fredericks does the roguelikedev tutorial - 7/8","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/rldev-8.html"},"url":"http://localhost:4000/rldev-8.html"}</script>
<!-- End Jekyll SEO tag -->


  </head>
  <body>
    <aside class="menu">
    <div class="menu-top">
        <div class="menu-top_logo">
            <a href="/" >
                <img src="/assets/img/Fredericks-Small.jpg" alt="Logo" onerror="this.style.display='none'">
            </a>
        </div>
        <div class="menu-top_expand" onclick="toggleExpander(this)">
            <div class="bar_top"></div>
            <div class="bar_middle"></div>
            <div class="bar_bottom"></div>
        </div>
        <ul class="navigation">
            
            <li>
                <a href="/" category="home" title=""
                
                >
                    <span>home</span>
                </a>
            </li>
            
            <li>
                <a href="/students.html" category="students" title="students tooltip"
                
                >
                    <span>students</span>
                </a>
            </li>
            
            <li>
                <a href="/teaching.html" category="teaching" title="teaching tooltip"
                
                >
                    <span>teaching</span>
                </a>
            </li>
            
            <li>
                <a href="/publications.html" category="publications" title="publications tooltip"
                
                >
                    <span>publications</span>
                </a>
            </li>
            
            <li>
                <a href="/activities.html" category="activities" title="activities tooltip"
                
                >
                    <span>activities</span>
                </a>
            </li>
            
            <li>
                <a href="/posts/" category="" title=""
                
                    class="selected"
                
                >
                    <span>posts</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="menu-contact">
        

        <a href="https://github.com/efredericks" target="_blank">
            <i class="fa fa-github"></i>
        </a>
        

        <a href="https://scholar.google.com/citations?user=wpdiGa0AAAAJ" target="_blank">
            <i class="fa fa-toilet-paper"></i>
        </a>
        

        <a href="https://youtube.com/@erikfredericks" target="_blank">
            <i class="fa fa-youtube-play"></i>
        </a>
        

        <a href="https://twitch.tv/mrdoktorprofessor" target="_blank">
            <i class="fa fa-twitch"></i>
        </a>
        

        <a href="https://twitter.com/erik_fredericks" target="_blank">
            <i class="fab fa-twitter"></i>
        </a>
        

        <a href="mailto:frederer@gvsu.edu" target="">
            <i class="fas fa-envelope"></i>
        </a>
        
    </div>
</aside>

      <main class="content-layout">
          <div class="post">
    <div class="content-container ">

        <header>
            <h1>fredericks does the roguelikedev tutorial - 7/8</h1>
            
        </header>
        <div class="post-content">
            <hr size="1" />

<ul>
  <li>
    <p><a href="https://www.reddit.com/r/roguelikedev/comments/15rltmg/roguelikedev_does_the_complete_roguelike_tutorial/jwajwkt/" target="_blank">Week 7 post</a></p>
  </li>
  <li>
    <p><a href="https://www.reddit.com/r/roguelikedev/comments/15xppyg/roguelikedev_does_the_complete_roguelike_tutorial/jx9yz3e/" target="_blank">Week 8 post</a></p>
  </li>
  <li>
    <p><a href="https://github.com/efredericks/RL-MMO" target="\_blank">Project repo</a></p>
  </li>
</ul>

<hr size="1" />

<p>There really wasn’t much to report for week 7 outside of a couple of minor things so I didn’t write a separate post for it, so I’ll include it in this last post for the roguelikedev tutorial event.  Overall it was quite fun and nice to see the other projects going as well.</p>

<p>tl;dr - definitely try out the tutorial if you have any interest in roguelikes, or game development in general.  Absolutely a great starting point into the area.</p>

<p>Reiterating my two favorites that this proof of concept was based on:</p>

<ul>
  <li>
    <p><a href="http://rogueliketutorials.com/tutorials/tcod/v2/" target="_blank">TCOD v2 (Python)</a></p>
  </li>
  <li>
    <p><a href="https://nluqo.github.io/broughlike-tutorial/" target="_blank">Broughlike Tutorial (JavaScript)</a></p>
  </li>
</ul>

<hr />

<h2 id="visual-updates">Visual updates</h2>

<p>First things first, a lot of the glyphs were being oddly aligned, and I realized that I wasn’t centering text when drawing to the canvas.  This has been corrected now and fixed with a simple call to update alignment prior to drawing the map (and setting it back to <code class="language-plaintext highlighter-rouge">left</code> when drawing the UI/chat messages):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctx.textAlign = "center";
</code></pre></div></div>

<p>Easy enough!  The next visual update is probably my favorite way to represent HP in games like this.  I calculate the percentage of the entity’s health based on their <code class="language-plaintext highlighter-rouge">HP</code> and <code class="language-plaintext highlighter-rouge">maxHP</code> and draw a pair of rectangles that represent this:</p>

<p><img src="https://i.imgur.com/PGXHjc6.gif" alt="Centered animations and HP bars" /></p>

<h2 id="dropsloot">Drops/Loot</h2>

<p>What is a game without loot?  Right now the only loot we have are apples, so that is the current thing to drop.  The intended extensions are scrolls, weapons, armor, etc., but that’s for future developments (i.e., when there would be a purpose to have them).</p>

<p>The easiest way to do this seemed to be having a drops table to aggregate everything,  Since I already have other lookup tables, it made the most sense to simply add on a new key:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drops': {
    'rat': [('apple', 1, 0.25)],
    'gobbo': [('apple', 3, 0.35)],
    'snek': [('apple', 5, 0.5)],
},
</code></pre></div></div>

<p>This table basically takes the entity name and provides options for what they drop and what the odds of that are.  When that monster is killed a simple check against <code class="language-plaintext highlighter-rouge">random.random()</code>.</p>

<h2 id="second-spell">Second spell</h2>

<p>Setting yourself for future success is always a good thing.  One of the functions I added to the map/entity generation was a <code class="language-plaintext highlighter-rouge">getRandomPosition</code> call that would return an empty, valid cell on the current map level.  This is suggested in pretty much any tutorial as well.  No cooldown and highly-abusable, but I wanted to get it in there to make sure it worked.</p>

<p><img src="https://i.imgur.com/BAJ5bIZ.gif" alt="Teleporting" /></p>

<h2 id="pathfinding">Pathfinding</h2>

<p>Now the big one - enemies now follow the player around blocking cells.  Thanks to the <a href="https://www.redblobgames.com/pathfinding/a-star/implementation.html" target="_blank">red blob games</a> post on getting me up and running with that.  (Note: the <code class="language-plaintext highlighter-rouge">tcod</code> library has this built in, I just haven’t really been using that library at all so I didn’t really feel like starting now).  I’ll leave the algorithm particularls to the prior link, but it is quite satisfying to see things working.</p>

<p><img src="https://i.imgur.com/BI8rwJS.gif" alt="Pathfinding" /></p>

<h2 id="new-enemy">New enemy</h2>

<p>I started getting interested in the physarum simulation, particularly how to make one in GPU shaders (always a fun mental activity to move thinking to matrix math mode - <a href="https://observablehq.com/@johnowhitaker/dotswarm-exploring-slime-mould-inspired-shaders" target="_blank">live display</a>)., but thought it might be fun to replicate the Nethack-style slime mold that self-replicates randomly.  Right now it is just a random check to see if it replicates or not.</p>

<p>But, the fun bit was that it abuses an existing function for get neighboring cells to pick a valid one, rather than introducing yet another search method for empty cells.  The nice bit was this caused me to slightly refactor my <code class="language-plaintext highlighter-rouge">Monster</code> class to better handle child classes.</p>

<p><img src="https://i.imgur.com/ypEhIgB.gif" alt="Slime mold" /></p>

<p>Last but not least, I gave the player a slight aura as one possible way to reflect what their current resists are (for instance, this one might be resistant against fire).  Not sure that I like this, but the other choice is figuring out doll parts for ASCII glpyhs…</p>

<p><img src="https://i.imgur.com/J4VzQxJ.png" alt="Aura" /></p>

<hr />

<p>That’s it for the summer!  This event was a lot of fun and I highly recommend it for anybody interested in roguelike development (as well as general game design - lots of good things to learn in the TCOD tutorial).</p>

<h2 id="whats-next">What’s next?</h2>

<p>Well, this proof of concept has the most promise of any of my little demos I’ve worked on, so I may pick at it throughout the school year either to iterate things or to use as demos for classes.</p>

<p>Some issues:</p>

<ul>
  <li>
    <p><em>Too many files to update</em> - when I make an update I need to update both the front-end and back-end code (for instance, adding a monster requires several steps internally to the back-end and visual representation on the front-end).  This is probably a lovely example of technical debt.</p>
  </li>
  <li>
    <p><em>Instancing</em> - this game uses Flask as a server.  I’ve tested it with a small handful of players, but not scaled up.  Some load testing is in my future, as well as figuring out how to instance things.  Might be a fun diversion for looking into cloud services.</p>
  </li>
  <li>
    <p><em>Saving</em> - right now everything exists in the <code class="language-plaintext highlighter-rouge">Game</code> class and is fairly easy to manage.  Some sort of local database and/or pickling may be in the future for saving game state.  Not something I’m entirely worried about at present.</p>
  </li>
  <li>
    <p><em>NPCs</em> - I really wanted to add some flavor to the game by having settlements, people wandering, etc.  Didn’t get there but have some ideas, mostly involving <a href="http://www.crystalcodepalace.com/tracery.html" target="_blank">Tracery</a> for procedural text generation via grammars.</p>
  </li>
</ul>

<p>That’s it - thanks for reading along!</p>

<hr />

<p><a href="/rldev-6.html">Last post</a></p>

        </div>
        <div class="post-metadata">
            <p class="discography-album_release-date">
    date: 20 August 2023
</p>


<p class="discography-album_type">
    post type: blog
</p>
















        </div>
    </div>
</div>

          <script>
    window.addEventListener("load", () => {
        document.getElementsByClassName("copyrights")[0].innerHTML =
            `Copyrights &copy; ${new Date().getFullYear()} erik fredericks | template c/o <a href='https://github.com/ItsPatrq/minimal-music-project' target='_blank'>minimal-music-project</a>`;
    });
</script>
<footer>
    <p class="copyrights">
    </p>
</footer>
      </main>
      
    <script>
      (function () {
    window.toggleExpander = function toggleExpander(x) {
        const menu = document.getElementsByClassName("menu")[0];
        const navigation = document.getElementsByClassName("navigation")[0];
        if (menu.classList.contains('expanded--visible')) {
            menu.classList.toggle('expanded--visible');
            navigation.addEventListener('transitionend', function(e) {
                menu.classList.toggle("expanded");
              }, {
                capture: false,
                once: true,
                passive: false
              });
        } else {
            menu.classList.toggle("expanded");
            setTimeout(() => menu.classList.toggle('expanded--visible'), 20);
        }
    };
    window.addEventListener("load", () => {
        // #region click to enlarge images 
        const imageWrappers = document.querySelectorAll(".click-to-enlarge");
        imageWrappers.forEach(imageWrapper => {
            
            imageWrapper.addEventListener("click", () => {
                const img = imageWrapper.getElementsByTagName("img")[0];
                const src = img.attributes.getNamedItem("src");
                const modal = document.createElement("div");
                const removeModal = function() {
                    modal.classList.add("hidden");
                    setTimeout(() => {
                        document.body.removeChild(modal);
                    }, 200);
                };
                const newImage = document.createElement("img");
                newImage.classList.add("modal__picture-zoomed--image");
                newImage.setAttribute("src", src.value);
                modal.classList.add("modal__picture-zoomed", "hidden");
                // modal.style.backgroundImage = `URL("${src.value}")`;
                modal.addEventListener("click", removeModal);
                modal.append(newImage);
                document.body.append(modal);
                document.body.addEventListener("keyup", e => {
                    if (e.key === 'Escape') {
                        removeModal();
                    }
                }, {once : true});
                setTimeout(() => {
                    modal.classList.remove("hidden");
                }, 0);
            });
            
        });
        // #endregion click to enlarge images 
        // #region embedded audio players
        const players = document.querySelectorAll("iframe.embedded-player");
        const getParamsByPlayerType = (src, type) => {
            const rt = (src, height) => ({
                src: src,
                height: height
            });
            switch (type.toLocaleLowerCase()) {
                case "soundcloud":
                    return rt(`https://w.soundcloud.com/player/?url=${src}`, 125);
                case "bandcamp":
                    return rt(`https://bandcamp.com/EmbeddedPlayer/${src}`, 125);
                case "spotify":
                    return rt(`https://open.spotify.com/embed/track/${src}`, 80);
                case "spotifyalbum":
                    return rt(`https://open.spotify.com/embed/album/${src}`, 80);
                case "spotifyplaylist":
                    return rt(`https://open.spotify.com/embed/playlist/${src}`, 80);
                case "spotifyepisode":
                    return rt(`https://open.spotify.com/embed/episode/${src}`, 152);
                case "spotifyshow":
                    return rt(`https://open.spotify.com/embed/show/${src}`, 152);
                case "youtube":
                    return rt(`https://www.youtube.com/embed/${src}`, 350);
                case "anchor.fm":
                    return rt(`https://anchor.fm/sucias/embed/episodes/${src}`,102);
                default:
                    return rt(src, 125);
            }
        };
        players.forEach(player => {
            const givenSrc = player.getAttribute("givenSrc");
            const type = player.getAttribute("type");
            const { src, height } = getParamsByPlayerType(givenSrc, type);
            player.setAttribute("src", src);
            player.setAttribute("height", height);
            player.classList.remove("hidden");
        });
        // #endregion embedded audio players
    });
})();
    </script>
    


  </body>
</html>