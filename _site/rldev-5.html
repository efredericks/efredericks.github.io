<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/assets/styles/styles.css">
<link rel="stylesheet" href="https://indestructibletype.com/fonts/Jost.css" type="text/css" charset="utf-8" />
<script src="https://kit.fontawesome.com/79c31398dc.js" crossorigin="anonymous"></script>

<!-- favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
<link rel="manifest" href="/assets/img/site.webmanifest">
<link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- feed -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="erik fredericks" />




<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>fredericks does the roguelikedev tutorial - 5 | erik fredericks</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="fredericks does the roguelikedev tutorial - 5" />
<meta name="author" content="efredericks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="aoe, procgen, chat" />
<meta property="og:description" content="aoe, procgen, chat" />
<meta property="twitter:description" content="aoe, procgen, chat" />
<link rel="canonical" href="http://localhost:4000/rldev-5.html" />
<meta property="og:url" content="http://localhost:4000/rldev-5.html" />
<meta property="og:site_name" content="erik fredericks" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-01T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="fredericks does the roguelikedev tutorial - 5" />
<meta name="twitter:site" content="@efredericks" />
<meta name="twitter:creator" content="@efredericks" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"efredericks"},"dateModified":"2023-08-01T00:00:00-04:00","datePublished":"2023-08-01T00:00:00-04:00","description":"aoe, procgen, chat","headline":"fredericks does the roguelikedev tutorial - 5","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/rldev-5.html"},"url":"http://localhost:4000/rldev-5.html"}</script>
<!-- End Jekyll SEO tag -->


  </head>
  <body>
    <aside class="menu">
    <div class="menu-top">
        <div class="menu-top_logo">
            <a href="/" >
                <img src="/assets/img/Fredericks-Small.jpg" alt="Logo" onerror="this.style.display='none'">
            </a>
        </div>
        <div class="menu-top_expand" onclick="toggleExpander(this)">
            <div class="bar_top"></div>
            <div class="bar_middle"></div>
            <div class="bar_bottom"></div>
        </div>
        <ul class="navigation">
            
            <li>
                <a href="/" category="home" title=""
                
                >
                    <span>home</span>
                </a>
            </li>
            
            <li>
                <a href="/students.html" category="students" title="students tooltip"
                
                >
                    <span>students</span>
                </a>
            </li>
            
            <li>
                <a href="/teaching.html" category="teaching" title="teaching tooltip"
                
                >
                    <span>teaching</span>
                </a>
            </li>
            
            <li>
                <a href="/publications.html" category="publications" title="publications tooltip"
                
                >
                    <span>publications</span>
                </a>
            </li>
            
            <li>
                <a href="/activities.html" category="activities" title="activities tooltip"
                
                >
                    <span>activities</span>
                </a>
            </li>
            
            <li>
                <a href="/posts/" category="" title=""
                
                    class="selected"
                
                >
                    <span>posts</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="menu-contact">
        

        <a href="https://github.com/efredericks" target="_blank">
            <i class="fa fa-github"></i>
        </a>
        

        <a href="https://scholar.google.com/citations?user=wpdiGa0AAAAJ" target="_blank">
            <i class="fa fa-toilet-paper"></i>
        </a>
        

        <a href="https://youtube.com/@erikfredericks" target="_blank">
            <i class="fa fa-youtube-play"></i>
        </a>
        

        <a href="https://twitch.tv/mrdoktorprofessor" target="_blank">
            <i class="fa fa-twitch"></i>
        </a>
        

        <a href="https://twitter.com/erik_fredericks" target="_blank">
            <i class="fab fa-twitter"></i>
        </a>
        

        <a href="mailto:frederer@gvsu.edu" target="">
            <i class="fas fa-envelope"></i>
        </a>
        
    </div>
</aside>

      <main class="content-layout">
          <div class="post">
    <div class="content-container ">

        <header>
            <h1>fredericks does the roguelikedev tutorial - 5</h1>
            
        </header>
        <div class="post-content">
            <hr size="1" />

<ul>
  <li>
    <p><a href="https://www.reddit.com/r/roguelikedev/comments/15fd445/roguelikedev_does_the_complete_roguelike_tutorial/jucg531/" target="_blank">Week 5 post</a></p>
  </li>
  <li>
    <p><a href="https://github.com/efredericks/RL-MMO" target="_blank">Project repo</a></p>
  </li>
</ul>

<hr size="1" />

<p>This week introduces player area of effect spells (singular currently), a Drunkard’s Walk algorithm for map generation, and chat backgrounds for players (enemies lose theirs).  Mostly it was in touching up some things on the backend to better support the effects.</p>

<p>Also, enemy pathfinding gets a touch of rework so that enemies “forget” about players.</p>

<hr />

<h2 id="chat-backgrounds">Chat Backgrounds</h2>

<p>I was really not up for doing the calculations necessary to draw a chat balloon in the canvas, so I turned to our old friend StackOverflow to see if there were pre-existing solutions to the problem.  Fortunately, chat bubbles are pretty common things to have, so there were numerous questions out there for how to draw them.</p>

<p>I liked this one the most, though I removed the little directional bit (for now):  <a href="https://stackoverflow.com/questions/21597644/speech-buble-html5-canvas-js" target="_blank">https://stackoverflow.com/questions/21597644/speech-buble-html5-canvas-js</a></p>

<div align="center">
  <img src="https://i.imgur.com/G55Vmv6.png" alt="player chat" title="player chat" />
</div>

<p>Enemies also lose their bubbles because the screen got <em>really</em> messy with everybody chattering.  I still think I prefer this to a message log though - we’ll see if “important” messages still get logged.  It makes sense for a traditional roguelike, though here I don’t know that it does.</p>

<hr />

<h2 id="procgen---drunkards-walk">Procgen - Drunkard’s Walk</h2>

<p>First off, I tweaked the order of generation.  The overworld gets the Simplex noise forest and sub-levels are now created via a <a href="https://en.wikipedia.org/wiki/Random_walk" target="_blank">drunkard’s walk</a>.  The <em>tentative</em> plan is for sub-levels to have their own algorithms creating them (caves, dungeons, etc.).  I think if and when I get to an actual narrative those choices will become clearer.</p>

<p>However, this one is easy enough.  Fill a map with walls and then carve out walkable spaces based on the stumblings of a drunkard.  My implementation currently does not take connectivity into account, so there are chances that I’ll have disconnected areas.</p>

<p>Targets of optimization for a future flood fill check (when a cellular automata gets added).  Right now I give it enough iterations/time that it hasn’t been an issue for the smaller map size.</p>

<p>Here’s the algorithm - again, fairly simple.  <code class="language-plaintext highlighter-rouge">ENEMY_DIRS</code> is a global list of possible directions that enemies can walk in (essentially the cardinal/ordinal directions) that I just reused here.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def drunkardsMap(self, z):
    _map = [['wall2'] * self.NUM_COLS for _ in range(self.NUM_ROWS)]

    center_c = self.NUM_COLS//2
    center_r = self.NUM_ROWS//2

    for _ in range(DRUNK_ITERATIONS):
        curr_c = center_c
        curr_r = center_r
        DRUNK_LIFETIME = self.NUM_COLS * self.NUM_ROWS

        for i in range(DRUNK_LIFETIME):
            _map[curr_r][curr_c] = random.choice(['empty', 'empty', 'floor1', 'floor1', 'floor2'])

            new_dir = random.choice(ENEMY_DIRS)
            curr_r += new_dir['r']
            curr_c += new_dir['c']

            # out of bounds
            if curr_c == 0 or curr_r == 1 or curr_c == self.NUM_COLS-1 or curr_r == self.NUM_ROWS-1:
                break

    return _map
</code></pre></div></div>

<p>Here we have the player going down to the first sub-level.  Looks like a fairly standard randomly-carved out space!</p>

<div align="center">
  <img src="https://i.imgur.com/a2T233M.gif" alt="drunkard" title="drunkard" />
</div>

<p>(Note to future self: fix the odd offset between ASCII and Unicode characters):</p>

<div align="center">
  <img src="https://i.imgur.com/DjVFihK.png" alt="offset" title="offset" />
</div>

<hr />

<h2 id="aoe---fire">AoE - Fire</h2>

<p>This took a little longer than I thought as I had figured I could re-use my <code class="language-plaintext highlighter-rouge">Item</code> entity setup for spawning fireballs surrounding the player.  It would have been more special handling than I wanted in that class, so <code class="language-plaintext highlighter-rouge">effects</code> are now their own thing.</p>

<p>What it boils down to is that I spawn a set of effect objects, give them a lifetime, define <em>what</em> they do, and then track them like all other entities.</p>

<p><strong>Note: what should probably happen is that every entity gets their own <code class="language-plaintext highlighter-rouge">update</code> function and self-handles - I haven’t gotten there yet with refactoring</strong>.</p>

<p>However, for now it just goes into the lookup table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># key: {attr:impact, timeout: upper}
'effects': {
    'fire': {'hp': -3, 'timer': 10},
    'heal': {'hp': 1, 'timer': 5},
}
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">timer</code> field is the upper limit of how long it lasts.  Essentially a target for future randomization (perhaps the fire lasts for <code class="language-plaintext highlighter-rouge">random.randint(5, LOOKUP_STATS['effects']['fire']['timer'])</code>).</p>

<p>Anyway, here’s a shot of some rats and goblins getting toasted:</p>

<div align="center">
  <img src="https://i.imgur.com/GtnnYcF.gif" alt="fire!" title="fire!" />
</div>

<p>Right now it doesn’t hurt the player to walk over their own flames, though I might change that up as it seems a bit overpowered to leave firebombs burning while the player escapes unharmed.</p>

<p>I’d really like AoE effects to interact with the environment (fire burns grasses, trees, etc.), but we’ll see how that pans out.  To do that I’d need a separate hook for the environment to respawn over time, then we’re talking going down the path of simulating a world’s ecological systems, and that might be a bit <em>too</em> much to bite off right now.</p>

<p>Other spell targets are a group heal, electricity, etc.</p>

<hr />

<h2 id="enemy-following">Enemy Following</h2>

<p>Enemies now follow a particular player rather than simply wandering and locking on to whoever is closest.  Enemies will wander until a player is close enough (currently the camera range) and will then try to follow that person.  If the player goes out of range the enemy will forget about them and go back to wandering/scanning.</p>

<p>Essentially, players can now escape the clutches of the hordes of the underdark.  No GIF here as it would be fairly boring, but enemies will basically stop following you if you just walk away from them.</p>

<p>(This is somewhat extensible to different follow/forget types of enemies as well - larger/smaller radii, etc.)</p>

<hr />

<p>Last little bit - I started breaking up the files into specific uses - e.g., utility functions go in <code class="language-plaintext highlighter-rouge">utils.js</code>, etc.  I’ve been keeping everything in single files just to avoid navigating through 30 different files (something that is annoying during development to me personally - I know that long term it is a terrible idea and freely admit that).  However, for posterity things are getting broken apart and placed into their proper locations.  Not done yet, but the process has begun.</p>

<hr />

<p>Next time I’d really like to get <em>some</em> sort of feedback from attacks, as the bump to attack feels very unsatisfying at the moment.  I’ve been playing with the sound off as well, so no additions there.</p>

<p>Also, more procgen algorithms!  Eyeballing cellular automata and BSP generation.</p>

<hr />
<p><a href="/rldev-4.html">Last post</a></p>

<p><a href="/rldev-6.html">Next post</a></p>

        </div>
        <div class="post-metadata">
            <p class="discography-album_release-date">
    date: 01 August 2023
</p>


<p class="discography-album_type">
    post type: blog
</p>
















        </div>
    </div>
</div>

          <script>
    window.addEventListener("load", () => {
        document.getElementsByClassName("copyrights")[0].innerHTML =
            `Copyrights &copy; ${new Date().getFullYear()} erik fredericks | template c/o <a href='https://github.com/ItsPatrq/minimal-music-project' target='_blank'>minimal-music-project</a>`;
    });
</script>
<footer>
    <p class="copyrights">
    </p>
</footer>
      </main>
      
    <script>
      (function () {
    window.toggleExpander = function toggleExpander(x) {
        const menu = document.getElementsByClassName("menu")[0];
        const navigation = document.getElementsByClassName("navigation")[0];
        if (menu.classList.contains('expanded--visible')) {
            menu.classList.toggle('expanded--visible');
            navigation.addEventListener('transitionend', function(e) {
                menu.classList.toggle("expanded");
              }, {
                capture: false,
                once: true,
                passive: false
              });
        } else {
            menu.classList.toggle("expanded");
            setTimeout(() => menu.classList.toggle('expanded--visible'), 20);
        }
    };
    window.addEventListener("load", () => {
        // #region click to enlarge images 
        const imageWrappers = document.querySelectorAll(".click-to-enlarge");
        imageWrappers.forEach(imageWrapper => {
            
            imageWrapper.addEventListener("click", () => {
                const img = imageWrapper.getElementsByTagName("img")[0];
                const src = img.attributes.getNamedItem("src");
                const modal = document.createElement("div");
                const removeModal = function() {
                    modal.classList.add("hidden");
                    setTimeout(() => {
                        document.body.removeChild(modal);
                    }, 200);
                };
                const newImage = document.createElement("img");
                newImage.classList.add("modal__picture-zoomed--image");
                newImage.setAttribute("src", src.value);
                modal.classList.add("modal__picture-zoomed", "hidden");
                // modal.style.backgroundImage = `URL("${src.value}")`;
                modal.addEventListener("click", removeModal);
                modal.append(newImage);
                document.body.append(modal);
                document.body.addEventListener("keyup", e => {
                    if (e.key === 'Escape') {
                        removeModal();
                    }
                }, {once : true});
                setTimeout(() => {
                    modal.classList.remove("hidden");
                }, 0);
            });
            
        });
        // #endregion click to enlarge images 
        // #region embedded audio players
        const players = document.querySelectorAll("iframe.embedded-player");
        const getParamsByPlayerType = (src, type) => {
            const rt = (src, height) => ({
                src: src,
                height: height
            });
            switch (type.toLocaleLowerCase()) {
                case "soundcloud":
                    return rt(`https://w.soundcloud.com/player/?url=${src}`, 125);
                case "bandcamp":
                    return rt(`https://bandcamp.com/EmbeddedPlayer/${src}`, 125);
                case "spotify":
                    return rt(`https://open.spotify.com/embed/track/${src}`, 80);
                case "spotifyalbum":
                    return rt(`https://open.spotify.com/embed/album/${src}`, 80);
                case "spotifyplaylist":
                    return rt(`https://open.spotify.com/embed/playlist/${src}`, 80);
                case "spotifyepisode":
                    return rt(`https://open.spotify.com/embed/episode/${src}`, 152);
                case "spotifyshow":
                    return rt(`https://open.spotify.com/embed/show/${src}`, 152);
                case "youtube":
                    return rt(`https://www.youtube.com/embed/${src}`, 350);
                case "anchor.fm":
                    return rt(`https://anchor.fm/sucias/embed/episodes/${src}`,102);
                default:
                    return rt(src, 125);
            }
        };
        players.forEach(player => {
            const givenSrc = player.getAttribute("givenSrc");
            const type = player.getAttribute("type");
            const { src, height } = getParamsByPlayerType(givenSrc, type);
            player.setAttribute("src", src);
            player.setAttribute("height", height);
            player.classList.remove("hidden");
        });
        // #endregion embedded audio players
    });
})();
    </script>
    


  </body>
</html>