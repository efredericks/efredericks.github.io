<!DOCTYPE html>
<html lang="en-us" class="h-100">
  <head>
    <title>
      fredericks does the roguelikedev tutorial - 5 – erik fredericks – assoc prof @ gvsu
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The page supports both dark and light color schemes, and the page author prefers / default is light. -->
    <meta name="color-scheme" content="dark light" />
    <!-- Stylesheet that includes Bootstrap dark mode & custom stylesheet -->
    <link
      rel="stylesheet"
      href="/assets/css/styles.css"
    />
    <link rel="icon" href="/assets/images/favicon.ico" />
    <!-- Meta Theme Color is also supported on Safari and Chrome -->
    <meta
      name="theme-color"
      content="#eeeeee"
      media="(prefers-color-scheme: dark)"
    />
    <meta
      name="theme-color"
      content="#111111"
      media="(prefers-color-scheme: light)"
    />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>fredericks does the roguelikedev tutorial - 5 | assoc prof @ gvsu.eduo</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="fredericks does the roguelikedev tutorial - 5" />
<meta name="author" content="erik-fredericks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="aoe, procgen, chat" />
<meta property="og:description" content="aoe, procgen, chat" />
<meta property="og:site_name" content="assoc prof @ gvsu.eduo" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-01T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="fredericks does the roguelikedev tutorial - 5" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"erik-fredericks"},"dateModified":"2023-08-01T00:00:00-04:00","datePublished":"2023-08-01T00:00:00-04:00","description":"aoe, procgen, chat","headline":"fredericks does the roguelikedev tutorial - 5","mainEntityOfPage":{"@type":"WebPage","@id":"/2023/08/01/rldev-5/"},"url":"/2023/08/01/rldev-5/"}</script>
<!-- End Jekyll SEO tag -->
 <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="assoc prof @ gvsu.eduo" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/p5@2.1.1/lib/p5.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rubik+Glitch&display=swap" rel="stylesheet">
  </head>
  <body class="d-flex flex-column h-100">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light">
  <div class="container-fluid">
    <!-- <a class="navbar-brand p-0 rubik-glitch-regular" href="/"> -->
    <a class="navbar-brand p-0" href="/">
    
    <img src="/assets/images/Fredericks-Small.jpg" alt="light avatar" width="30" class="d-inline-block align-top m-0 light-avatar">
    <img src="/assets/images/Fredericks-Small.jpg" alt="dark avatar" width="30" class="d-inline-block align-top m-0 dark-avatar">
    
      erik fredericks</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        
          <li class="nav-item">
            <a href="/"  class="nav-link" >home</a>
          </li>
        
          <li class="nav-item">
            <a href="/about/"  class="nav-link" >about</a>
          </li>
        
          <li class="nav-item">
            <a href="/publications/"  class="nav-link" >publications</a>
          </li>
        
          <li class="nav-item">
            <a href="/teaching/"  class="nav-link" >teaching</a>
          </li>
        
          <li class="nav-item">
            <a href="/students/"  class="nav-link" >students</a>
          </li>
        
          <li class="nav-item">
            <a href="/activities/"  class="nav-link" >activities</a>
          </li>
        
          <li class="nav-item">
            <a href="/posts/"  class="nav-link" >posts</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

      <div class="body"><div class="post">
  <h1>fredericks does the roguelikedev tutorial - 5</h1>
  <span class="fs-4 text-muted">Aug 01, 23</span>
  <div class="mt-4"><hr size="1" />

<ul>
  <li>
    <p><a href="https://www.reddit.com/r/roguelikedev/comments/15fd445/roguelikedev_does_the_complete_roguelike_tutorial/jucg531/" target="_blank">Week 5 post</a></p>
  </li>
  <li>
    <p><a href="https://github.com/efredericks/RL-MMO" target="_blank">Project repo</a></p>
  </li>
</ul>

<hr size="1" />

<p>This week introduces player area of effect spells (singular currently), a Drunkard’s Walk algorithm for map generation, and chat backgrounds for players (enemies lose theirs).  Mostly it was in touching up some things on the backend to better support the effects.</p>

<p>Also, enemy pathfinding gets a touch of rework so that enemies “forget” about players.</p>

<hr />

<h2 id="chat-backgrounds">Chat Backgrounds</h2>

<p>I was really not up for doing the calculations necessary to draw a chat balloon in the canvas, so I turned to our old friend StackOverflow to see if there were pre-existing solutions to the problem.  Fortunately, chat bubbles are pretty common things to have, so there were numerous questions out there for how to draw them.</p>

<p>I liked this one the most, though I removed the little directional bit (for now):  <a href="https://stackoverflow.com/questions/21597644/speech-buble-html5-canvas-js" target="_blank">https://stackoverflow.com/questions/21597644/speech-buble-html5-canvas-js</a></p>

<div align="center">
  <img src="https://i.imgur.com/G55Vmv6.png" alt="player chat" title="player chat" />
</div>

<p>Enemies also lose their bubbles because the screen got <em>really</em> messy with everybody chattering.  I still think I prefer this to a message log though - we’ll see if “important” messages still get logged.  It makes sense for a traditional roguelike, though here I don’t know that it does.</p>

<hr />

<h2 id="procgen---drunkards-walk">Procgen - Drunkard’s Walk</h2>

<p>First off, I tweaked the order of generation.  The overworld gets the Simplex noise forest and sub-levels are now created via a <a href="https://en.wikipedia.org/wiki/Random_walk" target="_blank">drunkard’s walk</a>.  The <em>tentative</em> plan is for sub-levels to have their own algorithms creating them (caves, dungeons, etc.).  I think if and when I get to an actual narrative those choices will become clearer.</p>

<p>However, this one is easy enough.  Fill a map with walls and then carve out walkable spaces based on the stumblings of a drunkard.  My implementation currently does not take connectivity into account, so there are chances that I’ll have disconnected areas.</p>

<p>Targets of optimization for a future flood fill check (when a cellular automata gets added).  Right now I give it enough iterations/time that it hasn’t been an issue for the smaller map size.</p>

<p>Here’s the algorithm - again, fairly simple.  <code class="language-plaintext highlighter-rouge">ENEMY_DIRS</code> is a global list of possible directions that enemies can walk in (essentially the cardinal/ordinal directions) that I just reused here.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def drunkardsMap(self, z):
    _map = [['wall2'] * self.NUM_COLS for _ in range(self.NUM_ROWS)]

    center_c = self.NUM_COLS//2
    center_r = self.NUM_ROWS//2

    for _ in range(DRUNK_ITERATIONS):
        curr_c = center_c
        curr_r = center_r
        DRUNK_LIFETIME = self.NUM_COLS * self.NUM_ROWS

        for i in range(DRUNK_LIFETIME):
            _map[curr_r][curr_c] = random.choice(['empty', 'empty', 'floor1', 'floor1', 'floor2'])

            new_dir = random.choice(ENEMY_DIRS)
            curr_r += new_dir['r']
            curr_c += new_dir['c']

            # out of bounds
            if curr_c == 0 or curr_r == 1 or curr_c == self.NUM_COLS-1 or curr_r == self.NUM_ROWS-1:
                break

    return _map
</code></pre></div></div>

<p>Here we have the player going down to the first sub-level.  Looks like a fairly standard randomly-carved out space!</p>

<div align="center">
  <img src="https://i.imgur.com/a2T233M.gif" alt="drunkard" title="drunkard" />
</div>

<p>(Note to future self: fix the odd offset between ASCII and Unicode characters):</p>

<div align="center">
  <img src="https://i.imgur.com/DjVFihK.png" alt="offset" title="offset" />
</div>

<hr />

<h2 id="aoe---fire">AoE - Fire</h2>

<p>This took a little longer than I thought as I had figured I could re-use my <code class="language-plaintext highlighter-rouge">Item</code> entity setup for spawning fireballs surrounding the player.  It would have been more special handling than I wanted in that class, so <code class="language-plaintext highlighter-rouge">effects</code> are now their own thing.</p>

<p>What it boils down to is that I spawn a set of effect objects, give them a lifetime, define <em>what</em> they do, and then track them like all other entities.</p>

<p><strong>Note: what should probably happen is that every entity gets their own <code class="language-plaintext highlighter-rouge">update</code> function and self-handles - I haven’t gotten there yet with refactoring</strong>.</p>

<p>However, for now it just goes into the lookup table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># key: {attr:impact, timeout: upper}
'effects': {
    'fire': {'hp': -3, 'timer': 10},
    'heal': {'hp': 1, 'timer': 5},
}
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">timer</code> field is the upper limit of how long it lasts.  Essentially a target for future randomization (perhaps the fire lasts for <code class="language-plaintext highlighter-rouge">random.randint(5, LOOKUP_STATS['effects']['fire']['timer'])</code>).</p>

<p>Anyway, here’s a shot of some rats and goblins getting toasted:</p>

<div align="center">
  <img src="https://i.imgur.com/GtnnYcF.gif" alt="fire!" title="fire!" />
</div>

<p>Right now it doesn’t hurt the player to walk over their own flames, though I might change that up as it seems a bit overpowered to leave firebombs burning while the player escapes unharmed.</p>

<p>I’d really like AoE effects to interact with the environment (fire burns grasses, trees, etc.), but we’ll see how that pans out.  To do that I’d need a separate hook for the environment to respawn over time, then we’re talking going down the path of simulating a world’s ecological systems, and that might be a bit <em>too</em> much to bite off right now.</p>

<p>Other spell targets are a group heal, electricity, etc.</p>

<hr />

<h2 id="enemy-following">Enemy Following</h2>

<p>Enemies now follow a particular player rather than simply wandering and locking on to whoever is closest.  Enemies will wander until a player is close enough (currently the camera range) and will then try to follow that person.  If the player goes out of range the enemy will forget about them and go back to wandering/scanning.</p>

<p>Essentially, players can now escape the clutches of the hordes of the underdark.  No GIF here as it would be fairly boring, but enemies will basically stop following you if you just walk away from them.</p>

<p>(This is somewhat extensible to different follow/forget types of enemies as well - larger/smaller radii, etc.)</p>

<hr />

<p>Last little bit - I started breaking up the files into specific uses - e.g., utility functions go in <code class="language-plaintext highlighter-rouge">utils.js</code>, etc.  I’ve been keeping everything in single files just to avoid navigating through 30 different files (something that is annoying during development to me personally - I know that long term it is a terrible idea and freely admit that).  However, for posterity things are getting broken apart and placed into their proper locations.  Not done yet, but the process has begun.</p>

<hr />

<p>Next time I’d really like to get <em>some</em> sort of feedback from attacks, as the bump to attack feels very unsatisfying at the moment.  I’ve been playing with the sound off as well, so no additions there.</p>

<p>Also, more procgen algorithms!  Eyeballing cellular automata and BSP generation.</p>

<hr />
<p><a href="/rldev-4.html">Last post</a></p>

<p><a href="/rldev-6.html">Next post</a></p>
</div>
</div>
</div>
    </div>
    <footer class="footer mt-auto py-3">
  <div class="container footer-container">
<a class="footer-icon-links" href="mailto:frederer@gvsu.edu">
  <i class="bi bi-envelope-at"></i>
</a>
  

<a
  class="footer-icon-links"
  href="https://github.com/efredericks"
  >
  <i class="bi bi-github"></i>
</a>
 

<a
  class="footer-icon-links"
  href="https://www.twitter.com/erik_fredericks"
  >
  <i class="bi bi-twitter"></i>
</a>
  
 
<a class="footer-icon-links" href="https://youtube.com/@erikfredericks">
  <i class="bi bi-youtube"></i>
</a>

<a class="footer-icon-links" href="https://twitch.tv/mrdoktorprofessor">
  <i class="bi bi-twitch"></i>
</a>


<a class="footer-icon-links" href="/feed.xml"
  >
  <i class="bi bi-rss"></i>
</a>


<a class="footer-icon-links" href="https://scholar.google.com/citations?user=wpdiGa0AAAAJ">
 <!-- Toilet Paper icon by Arthur Shlain from Usefulicons.com -->
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" version="1.1" x="0px" y="0px" 
    width="16"
    height="16"
    fill="currentColor"
    class="bi bi-rss footer-icons"
    viewBox="0 0 100 100"
>
  <path d="M75,10L42,10C47,17.2,50,27.7,50,40L90,40C90,23.4,83.3,10,75,10Z" stroke="currentColor"></path><path d="M40,40C40,23.4,33.3,10,25,10S10,23.4,10,40S16.7,70,25,70S40,56.6,40,40ZM20,40C20,34.5,22.2,30,25,30S30,34.5,30,40C30,45.5,27.8,50,25,50S20,45.5,20,40Z" stroke="currentColor"></path><path d="M50,50L90,50L90,90L50,90L50,50Z" stroke="currentColor"></path></svg>
  </a> 
  
  |

  based on <a href="https://github.com/andrewhwanpark/brutalist-blog" target="_blank">brutalist-blog theme</a></div>
</footer>

    <!-- JS for Bootstrap -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
