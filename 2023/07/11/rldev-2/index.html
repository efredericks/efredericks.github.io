<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      fredericks does the roguelikedev tutorial - 2 &middot; erik fredericks
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/hyde/public/css/poole.css">
  <link rel="stylesheet" href="/hyde/public/css/syntax.css">
  <link rel="stylesheet" href="/hyde/public/css/hyde.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rubik+Glitch&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/hyde/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/hyde/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

<script src="https://cdn.jsdelivr.net/npm/p5@2.1.1/lib/p5.js"></script>
</head>


  <body>

 <!-- class="theme-base-0c"> -->

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/hyde/" class="rubik-glitch-regular">
          erik fredericks
        </a>
      </h1>
      <p class="lead">assoc prof @ gvsu</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/hyde/">home</a>

      

      
      
        
          
        
      
        
          
            
            <a class="sidebar-nav-item" href="/about/">about me</a>
            
          
        
      
        
      
        
      
        
          
            
            <a class="sidebar-nav-item" href="/publications.html">publications</a>
            
          
        
      
        
          
            
          
        
      
        
          
            
          
        
      
        
          
            
          
        
      

      <!-- <a class="sidebar-nav-item" href="https://github.com/efredericks/archive/v2.1.0.zip">Download</a> -->
      <a class="sidebar-nav-item" href="https://github.com/efredericks">github</a>
      <!-- <span class="sidebar-nav-item">Currently v2.1.0</span> -->
       <hr size="1" class="smolmargin" />

      <a class="sidebar-nav-item" href="/posts/">posts</a>

    </nav>

    <p>&copy; 2025. all rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">fredericks does the roguelikedev tutorial - 2</h1>
  <span class="post-date">11 Jul 2023</span>
  <hr size="1" />

<ul>
  <li>
    <p><a href="https://www.reddit.com/r/roguelikedev/comments/14wuzqa/roguelikedev_does_the_complete_roguelike_tutorial/jrkdlgr/" target="_blank">Week 2 post</a></p>
  </li>
  <li>
    <p><a href="https://github.com/efredericks/RL-MMO" target="_blank">Project repo</a></p>
  </li>
</ul>

<hr size="1" />

<p>This week I wanted to start by turning my ‚Äúsimple‚Äù entities into proper objects.  Previously anything that moved was simply a row/column position dictionary.  Nice for prototyping, bad for anything else.</p>

<p>Somewhat following a mishmash of multiple tutorials I created a base <code class="language-plaintext highlighter-rouge">Entity</code> class and a child <code class="language-plaintext highlighter-rouge">MoveableEntity</code> class, where <code class="language-plaintext highlighter-rouge">Entity</code> is intended to not move (e.g., items).  Every object also now gets a unique identifier so that I can track them, care of the <a href="https://docs.python.org/3/library/uuid.html" target="_blank"><code class="language-plaintext highlighter-rouge">uuid</code> Python class</a>.</p>

<p>I may end up needing to refactor as I‚Äôm not truly following the tutorial and just using it as an excuse to work on yet another roguelike, however here is where we‚Äôre at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Base entity class
class Entity:
    def __init__(self, _type, pos, entity_id=None, count=None):
        assert _type in ENTITY_NAMES, "Error: ${0} not found in lookup table.".format(_type)

        self.entity_id = entity_id
        self._type = _type
        self.pos = pos
        self.count = count

    def getTransmissable(self):
        return {
            'type': self._type,
            'pos': self.pos,
            'count': self.count,
        }

# Entity that can move around the screen
class MoveableEntity(Entity):
    def __init__(self, _type, pos, entity_id=None):
        super().__init__(_type, pos, entity_id)

        # particulars
        self._type = _type
        self.pos = pos
        self.entity_id = entity_id # only used for logged in players

        # stats
        self.hp = LOOKUP_STATS['maxHP'][_type]
        self.maxHP = LOOKUP_STATS['maxHP'][_type]
        self.active = True
        self.inventory = {}

    def getTransmissable(self):
        return {
            'type': self._type,
            'pos': self.pos,
            'hp': self.hp,
            'maxHP': self.maxHP,
            'active': self.active,
            'inventory': self.inventory,
        }

</code></pre></div></div>

<p>Couple of points here that were important to me.  I have a <code class="language-plaintext highlighter-rouge">LOOKUP_STATS</code> dictionary in global space that serves as my overall balancing table for entity stats - who has what HP, etc.  I also have an <code class="language-plaintext highlighter-rouge">ENTITY_NAMES</code> list that is the global array of the names for all things that can be in the game (mainly as a check to make sure I didn‚Äôt typo anywhere when instantiating entities).  Most likely I‚Äôll move those to a dictionary that serves as a name/description table, but that‚Äôs for future me (insert technical debt here).</p>

<p>The other bit is the <code class="language-plaintext highlighter-rouge">getTransmissable</code> function.  This serves to break the object down into what gets sent along the socket so that we‚Äôre not packaging up the <strong>entire</strong> thing - only what matters to the frontend.  There are probably better ways of doing this, but I‚Äôm trying to keep it as light as possible.</p>

<p>So now, I can instantiate everything as an <code class="language-plaintext highlighter-rouge">Entity</code> or <code class="language-plaintext highlighter-rouge">MoveableEntity</code>, neat.</p>

<hr />

<p>Next up is to add in items to be scattered around for the player to pick up.  Here I used my new objects and created a new list focused around items - in this case apples.  Right now they serve no purpose other than to be picked up and added to the player‚Äôs inventory, however it works quite nicely.</p>

<div align="center">
  <img src="https://i.imgur.com/YXJFeSn.gif" alt="picking up apples" title="picking up apples" />
</div>

<p>With some additional socket work (i.e., also sending the items array as well as the player inventories) this behavior also works nicely with multiple players.  Not too hard as the logic is pretty much the same as enemy updates and was mostly copy and paste.</p>

<hr />

<p>This leads me to one future point that I should address.  Right now all of my <em>things</em> in the game are separate in that I have a dictionary of players (keyed on the session ID provided by Flask), a list of enemies, and a list of items.  It <em>works</em>, however it really isn‚Äôt to my liking for efficiency.  At some point in the near future I‚Äôll merge this into a single Entities object (or perhaps delineate Entities and MoveableEntities) and try to capture the logic into a bastardized Entity-Component pattern.</p>

<hr />

<p>Last update for the week - laying the groundwork for multiple levels/floors/instances/etc.  A new attribute was added to the position of all <code class="language-plaintext highlighter-rouge">Entity</code> objects: <code class="language-plaintext highlighter-rouge">level</code>.</p>

<p>I have a helper function that places the <code class="language-plaintext highlighter-rouge">Entity</code> on a clear spot within the map (no walls, etc.):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def getRandomPos(self, level=1):
        r = random.randint(0,self.NUM_ROWS-1)
        c = random.randint(0,self.NUM_COLS-1)
        while not self.isWalkable(c, r):
            r = random.randint(0,self.NUM_ROWS-1)
            c = random.randint(0,self.NUM_COLS-1)
        return {'r': r, 'c': c, 'level': level}
</code></pre></div></div>

<p>Now, it takes in the desired <code class="language-plaintext highlighter-rouge">level</code> of the object and includes it as something <em>very</em> easy to lookup.  The change cascades all over the current code, however any time there is a lookup for row/column, now the level is checked as well.  For instance, enemies only follow players on their level, socket data only sends current floor information relevant to the player, etc.</p>

<p>You may have noticed there aren‚Äôt any enemies in the last gif - that‚Äôs because I spawned them all on level 2 to check that my inventory/pickup system was working without needing to despawn them all:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def addEnemy(self):
    return MoveableEntity("snek", self.getRandomPos(level=2), str(uuid.uuid4()))
</code></pre></div></div>

<hr />

<p>That‚Äôs it for now - next week I‚Äôm hoping to add a camera system and/or a proper procedural content generation algorithm for the dungeon.  Or focus on a user interface so I don‚Äôt need to keep calling <code class="language-plaintext highlighter-rouge">console.log</code> any time I want to see data üôÑ.</p>

<hr />

<p><a href="/rldev-1.html">Last post</a></p>

<p><a href="/rldev-3.html">Next post</a></p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2025/10/22/cclub-ecs/">
            Computing Club Tutorial - Entity Component System (ECS)
            <small>22 Oct 2025</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2023/09/20/generativegi/">
            GenerativeGI - Project Writeup
            <small>20 Sep 2023</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2023/08/20/rldev-8/">
            fredericks does the roguelikedev tutorial - 7/8
            <small>20 Aug 2023</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
